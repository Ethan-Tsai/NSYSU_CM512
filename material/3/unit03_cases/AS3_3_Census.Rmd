---
title: "AS2-3: 美國人口普查資料"
author: "Group-00"
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: ../etc/style.css
---

```{r echo=F, results='hide', message=FALSE, warning=FALSE}
# Installation, setup & formatting. Do not modify this code chunk.  
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8); options(scipen=20, digits=4, width=90)
if(!require(pacman)) install.packages("pacman")
pacman::p_load(dplyr)
```
<br><br>

The major data is in `data/MetroAreaCodes.csv`. We read it into a data frame `D`.
```{r}
D = read.csv("data/CPSData.csv")
```

`D` 之中每一筆紀錄是一個受測對象，每一個欄位是一個調查問卷題項：

+ `PeopleInHousehold`: 受訪者家庭中的人數。
+ `Region`: 受訪者居住的人口普查區域。
+ `State`: 受訪者居住的州。
+ `MetroAreaCode`: 都會區代碼，如受訪者不住都會區，則為NA；從代碼到都會區名稱的對應在`MetroAreaCodes.csv`中提供。
+ `Age`: 受訪者的年齡，以年為單位。 80代表80-84歲的人，85代表85歲及以上的人。
+ `Married`: 受訪者的婚姻狀況。
+ `Sex`: 受訪者的性別。
+ `Education`: 受訪者獲得的最高教育程度。
+ `Race`: 受訪者的種族。
+ `Hispanic`: 受訪者是否屬於西班牙裔。
+ `CountryOfBirthcode`: 識別受訪者出生國家的代碼。從代碼到國家名稱的映射在CountryCodes.csv文件中提供。
+ `Citizenship`: 受訪者的公民身份。
+ `EmploymentStatus`: 受訪者的就業狀況。
+ `Industry`: 受訪者的就業行業（僅在受僱的情況下可用）。

<br>

🌷 這份作業的學習重點是： 

+ 缺項 (`NA`) 的觀念和處理方法
+ 資料表格(data frame)的合併

<br>

```{r}
summary(D)
```
In the `summary` we can see that there are 34,238 `NA`'s in `MetroAreaCode`.  Yet be careful ...

🌷 `summary` does not shows the numbers of `NA` in the character columns.

The best way to examine `NA` in a data frame is to pipe `is.na()` into `colSums()`.
```{r}
is.na(D) %>% colSums
```
now we see there are `NA`'s in `Married`, `Education`, `EmploymentStatus` and `Industry`. In the case of census, `NA` may occur when question items are ...

+ not answered
+ answered improperly 
+ not applicable to the respondents

<br><br>

###  Section-1 Loading and Summarizing the Dataset

__§ 1.1__ How many interviewees are in the dataset?
```{r}
#
#
```

__§ 1.2__ Among the interviewees with a value reported for the Industry variable, what is the most common industry of employment? Please enter the name exactly how you see it.
```{r}
#
#
```

__§ 1.3__ Which state has the fewest interviewees?
```{r}
#
#
```

Which state has the largest number of interviewees?
```{r}
#
#
```

__§ 1.4__ What proportion of interviewees are citizens of the United States?
```{r}
#
#
```

__§ 1.5__ For which races are there at least 250 interviewees in the CPS dataset of Hispanic ethnicity? 
```{r}
#
#
```

<br><br> 


###  Section-2 Evaluating Missing Values

__§ 2.1__ Which variables have at least one interviewee with a missing (NA) value? 
```{r}
#
#
```

__§ 2.2__  Which statements below is the most accurate:

+ The Married variable being missing is related to the Region value for the interviewee.
+ The Married variable being missing is related to the Sex value for the interviewee.
+ The Married variable being missing is related to the Age value for the interviewee. 
+ The Married variable being missing is related to the Citizenship value for the interviewee.
+ The Married variable being missing is not related to the Region, Sex, Age, or Citizenship value for the interviewee.

```{r}
#
#
```

🌻 Married is not applicable for interviewees who is younger than 15 years old. This type of `NA` occurs systematically. They are not random.  

__§ 2.3__ How many states had all interviewees living in a non-metropolitan area (aka they have a missing `MetroAreaCode` value)? For this question, treat the District of Columbia as a state (even though it is not technically a state).
```{r}
#
#
```

How many states had all interviewees living in a metropolitan area? Again, treat the District of Columbia as a state.
```{r}
#
#
```

__§ 2.4__ Which region of the United States has the largest proportion of interviewees living in a non-metropolitan area?
```{r}
#
#
```

__§ 2.5__ Which state has a proportion of interviewees living in a non-metropolitan area closest to 30%?
```{r}
#
#
```

Which state has the largest proportion of non-metropolitan interviewees, ignoring states where all interviewees were non-metropolitan?
```{r}
#
#
```

🌻 As we can see in the questions above, `NA`'s are not completely useless. Sometimes they carry useful information. 

<br><br> 

###  Section-3 Integrating Metropolitan Area Data

In this exercise, we have two more data files 

+ `data/MetroAreaCodes.csv` maps `D$MetroAreaCode` to the names of the Metro Area's
+ `data/CountryCodes.csv` maps `D$CountryCode` to the names of the Countries

```{r}
metro = read.csv("data/MetroAreaCodes.csv")
country = read.csv("data/CountryCodes.csv")
```

__§ 3.1__ How many observations (codes for metropolitan areas) are there in `MetroAreaMap`?
```{r}
# 
#
```

How many observations (codes for countries) are there in CountryMap?
```{r}
#
#
```

🌻 `merge(x, y, by.x, by.y, all.x, all.y)` merges two data frames `x` and `y`

+ `by.x` and `by.y` specify the merging keys in `x` and `y` respectively.
+ `all.x` and `all.y` specify whether all rows in `x` and `y` should be kept. The defaults are `FALSE` which implies rows that do not match are removed. When set to `TRUE`, the unmatched rows stay with the merged columns set to `NA`.

__§ 3.2__ Merge the `MetroArea` variable into the `D` data frame by merging keys `MetroAreaCode` and `Code`. What is the name of the variable that was added to the data frame by the merge() operation?
```{r}
D = merge(D, metro, by.x="MetroAreaCode", by.y="Code", all.x=TRUE)
```

How many interviewees have a missing value for the new metropolitan area variable?
```{r}
#
#
```

__§ 3.3__ Which of the following metropolitan areas has the largest number of interviewees?
```{r}
#
#
```

__§ 3.4__ Which metropolitan area has the highest proportion of interviewees of Hispanic ethnicity?
```{r}
#
#
```

__§ 3.5__ Determine the number of metropolitan areas in the United States from which at least 20% of interviewees are Asian.
```{r}
#
#
```

🌻 All mathematical and logical function return `NA` if there is any `NA` in their input vector(s). As an remedy, the `na.rm=TRUE` argument can exclude the `NA`'s from the input before calculation.    

__§ 3.6__  Passing `na.rm=TRUE` to the `tapply` function, determine which metropolitan area has the smallest proportion of interviewees who have received no high school diploma.
```{r}
#
#
```

<br><br> 


###  Section-4 Integrating Country of Birth Data

__§ 4.1__ Merge the `Country` variable into the `D` data frame by merging keys `CountryOfBirthCode` and `Code`. What is the name of the variable added to the data frame by this merge operation?
```{r}
D = merge(D, country, by.x="CountryOfBirthCode", by.y="Code", all.x=TRUE)
```

How many interviewees have a missing value for the new country variable?
```{r}
#
#
```

__§ 4.2__ Among all interviewees born outside of North America, which country was the most common place of birth?
```{r}
#
#
```

__§ 4.3__ What proportion of the interviewees from the "New York-Northern New Jersey-Long Island, NY-NJ-PA" metropolitan area have a country of birth that is not the United States? 
```{r}
#
#
```

__§ 4.4__ Which metropolitan area has the largest number (note -- not proportion) of interviewees with a country of birth in India? 
```{r}
#
#
```

In Brazil?
```{r}
#
#
```

In Somalia?
```{r}
#
#
```

<br><br><br>
